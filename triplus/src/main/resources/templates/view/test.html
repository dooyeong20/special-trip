<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout" xmlns:sec="http://www.w3.org/1999/xhtml"
      layout:decorate="layout/common_layout">

<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

<div layout:fragment="content">

    <body>
    <section class="ftco-section contact-section ftco-degree-bg">
        <div class="container">
            <div class="row">

                <ul class="nav nav-tabs flex-column col-3" role="tablist">
                    <a class="active text-center" th:href="@{/mypage}"><i class="fas fa-user-circle fa-10x mb-2 mr-sm-2"></i></a>

                    <p class="text-center" th:text="${user.nickName} + '님 환영합니다'"></p>

                    <li class="nav-item">
                        <a class="nav-link active" data-toggle="tab" href="#myPlan" style="font-weight: bold; font-size: 18px"><i class="far fa-calendar-alt fa-lg mb-2 mr-sm-2"></i>내 일정 보기</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" data-toggle="tab" href="#myReview" style="font-weight: bold; font-size: 18px"><i class="far fa-comment fa-lg mb-2 mr-sm-2"></i>내 리뷰 보기</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" data-toggle="tab" href="#myLike" style="font-weight: bold; font-size: 18px"><i class="fas fa-star fa-lg mb-2 mr-sm-2"></i>찜 목록</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" data-toggle="tab" href="#myInfo" style="font-weight: bold; font-size: 18px"><i class="fas fa-cog fa-lg mb-2 mr-sm-2"></i>내 정보 관리</a>
                    </li>
                </ul>

                <!-- Tab panes -->
                <div class="tab-content col-9">

                    <!-- myPlan -->
                    <div id="myPlan" class="container tab-pane active"><br>
                        <div class="content">
                            <div class="col-md-12 text-center">
                                <h2 class="mb-4"><i class="far fa-calendar-alt"></i> 내 일정 보기</h2>
                            </div>

                            <div class="row">
                                <th:block th:each="plan : ${planList}">
                                    <div class="col-md-4 d-flex ftco-animate fadeInUp ftco-animated planCard" data-toggle="modal" data-target="#myModal">
                                        <input type="hidden" class="plan_id" th:value="${plan.id}">
                                        <div class="blog-entry align-self-stretch" style="width:300px">
                                            <a class="block-20" th:style="'background:url(' + ${plan.mainImg} + '); background-size: cover; background-repeat: no-repeat;'"></a>
                                            <div class="text p-4 d-block">
                                                <a><span class="tag" th:text="${plan.dayCounts} + '일'" style="font-weight: bold; color: black;"></span></a>
                                                <h3 class="heading mt-4"><a th:text="${plan.name}"></a></h3>
                                                <div class="meta mb-4">
                                                    <div><a th:text="${plan.user.nickName}"></a></div><br>
                                                    <div><i class="fas fa-heart"><a th:text="${plan.liked}"></a></i></div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </th:block>
                            </div>
                        </div>
                    </div>

                    <!-- myReview -->
                    <div id="myReview" class="container tab-pane fade"><br>
                        <div class="content">
                            <div class="col-md-12 text-center">
                                <h2 class="mb-4"><i class="far fa-comment"></i> 내 리뷰 보기</h2>
                            </div>

                            <div class="review_sort_box mb-4">
                                <select id name class="review_sort">
                                    <option value="regdate">등록순</option>
                                    <option value="name">이름순</option>
                                </select>
                            </div>

                            <form th:action="@{/delete_review}" method="post" name="reviewForm">
                                <th:block th:each="review : ${reviewList}">
                                    <div class="review_list mb-5">
                                        <div class="row ml-1">
                                            <h6 class="review_place_name mr-2" th:text="${review.place.name}"></h6>
                                            <p class="review_place_name" th:text="${review.regdate}"></p>
                                        </div>
                                        <img class="blog-img placeImage" th:style="'background:url(' + ${review.place.thumbnailUrl}" width="80" height="70" style="margin:10px">
                                        <input class="review_place_content" th:value="${review.content}" style="width:600px; height:70px;">
                                        <!--								<div class="form-group">-->
                                        <!--									<input type="submit" value="삭제" class="btn btn-primary">-->
                                        <!--								</div>-->
                                    </div>
                                </th:block>
                            </form>
                        </div>
                    </div>

                    <!-- myLike -->
                    <div id="myLike" class="container tab-pane fade"><br>
                        <div class="content">
                            <div class="col-md-12 text-center">
                                <h2 class="mb-4"><i class="fas fa-star"></i> 찜목록</h2>
                            </div>
                            <!-- Nav tabs -->
                            <ul class="nav nav-tabs" role="tablist">
                                <li class="nav-item">
                                    <a class="nav-link active" data-toggle="tab" href="#attraction" style="font-weight: bold;">관광명소</a>
                                </li>
                                <li class="nav-item">
                                    <a class="nav-link" data-toggle="tab" href="#food" style="font-weight: bold;">음식점</a>
                                </li>
                                <li class="nav-item">
                                    <a class="nav-link" data-toggle="tab" href="#shop" style="font-weight: bold;">쇼핑</a>
                                </li>
                                <li class="nav-item">
                                    <a class="nav-link" data-toggle="tab" href="#festival" style="font-weight: bold;">축제</a>
                                </li>
                            </ul>

                            <!-- Tab panes -->
                            <div class="tab-content">
                                <div id="attraction" class="container tab-pane fade active show"><br>
                                    <div class="row">
                                        <th:block th:each="place : ${attractionList}">
                                            <div class="col-md-4 d-flex ftco-animate fadeInUp ftco-animated">
                                                <div class="blog-entry align-self-stretch">
                                                    <a th:href="@{/detail?content_id={id}(id=${place.contentId})}" class="block-20" th:style="'background:url(' + ${place.thumbnailUrl}">
                                                    </a>
                                                    <div class="text p-4 d-block">
                                                        <h3 class="heading mt-3"><a th:href="@{/detail?content_id={id}(id=${place.contentId})}" th:text="${place.name}"></a></h3>
                                                        <div class="meta mb-3">
                                                            <div><a th:text="${place.addr1}"></a></div>
                                                            <div><span><i class="fas fa-heart"></i> 3</span></div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </th:block>
                                    </div>
                                </div>

                                <div id="food" class="container tab-pane fade"><br>
                                    <div class="row">
                                        <th:block th:each="place : ${foodList}">
                                            <div class="col-md-4 d-flex ftco-animate fadeInUp ftco-animated">
                                                <div class="blog-entry align-self-stretch">
                                                    <a th:href="@{/detail?content_id={id}(id=${place.contentId})}" class="block-20" th:style="'background:url(' + ${place.thumbnailUrl}">
                                                    </a>
                                                    <div class="text p-4 d-block">
                                                        <h3 class="heading mt-3"><a th:href="@{/detail?content_id={id}(id=${place.contentId})}" th:text="${place.name}"></a></h3>
                                                        <div class="meta mb-3">
                                                            <div><a th:text="${place.addr1}"></a></div>
                                                            <div><span><i class="fas fa-heart"></i> 3</span></div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </th:block>
                                    </div>
                                </div>

                                <div id="shop" class="container tab-pane fade"><br>
                                    <div class="row">
                                        <th:block th:each="place : ${shopList}">
                                            <div class="col-md-4 d-flex ftco-animate fadeInUp ftco-animated">
                                                <div class="blog-entry align-self-stretch">
                                                    <a th:href="@{/detail?content_id={id}(id=${place.contentId})}" class="block-20" th:style="'background:url(' + ${place.thumbnailUrl}">
                                                    </a>
                                                    <div class="text p-4 d-block">
                                                        <h3 class="heading mt-3"><a th:href="@{/detail?content_id={id}(id=${place.contentId})}" th:text="${place.name}"></a></h3>
                                                        <div class="meta mb-3">
                                                            <div><a th:text="${place.addr1}"></a></div>
                                                            <div><span><i class="fas fa-heart"></i> 3</span></div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </th:block>
                                    </div>
                                </div>


                                <div id="festival" class="container tab-pane fade"><br>
                                    <div class="row">
                                        <th:block th:each="place : ${festivalList}">
                                            <div class="col-md-4 d-flex ftco-animate fadeInUp ftco-animated">
                                                <div class="blog-entry align-self-stretch">
                                                    <a th:href="@{/detail?content_id={id}(id=${place.contentId})}" class="block-20" th:style="'background:url(' + ${place.thumbnailUrl}">
                                                    </a>
                                                    <div class="text p-4 d-block">
                                                        <h3 class="heading mt-3"><a th:href="@{/detail?content_id={id}(id=${place.contentId})}" th:text="${place.name}"></a></h3>
                                                        <div class="meta mb-3">
                                                            <div><a th:text="${place.addr1}"></a></div>
                                                            <div><span><i class="fas fa-heart"></i> 3</span></div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </th:block>
                                    </div>
                                </div>

                            </div>
                        </div>
                    </div>

                    <!-- myInfo -->
                    <div id="myInfo" class="container tab-pane fade"><br>
                        <div class="content">
                            <div class="col-md-12 text-center">
                                <h2 class="mb-4"><i class="fas fa-cog"></i> 내 정보 관리</h2>
                            </div>
                            <form th:action="@{/mypage}" method="post" name="updateForm">

                                <table width="500" height="600" border="2" align="center" rules="none">
                                    <tr align="center">
                                        <td width="20%" style="font-weight: bold">Nickname</td>
                                        <td width="80%"><input type="text" th:value="${user.nickName}"></td>

                                    </tr>

                                    <tr align="center">
                                        <td width="20%" style="font-weight: bold">Email</td>
                                        <td width="80%"><input type="text" th:value="${user.email}" readonly></td>
                                    </tr>

                                    <tr align="center">
                                        <td width="20%" style="font-weight: bold">Password</td>
                                        <td width="80%"><input type="password" th:value="${user.password}"></td>
                                    </tr>

                                    <tr align="center">
                                        <td width="20%" style="font-weight: bold">Confirm Password</td>
                                        <td width="80%"><input type="text" th:value="${user.password}"></td>
                                    </tr>

                                </table>
                            </form>

                            <tr align="center">
                                <td colspan="2">
                                    <button type="button" id="save" class="btn btn-primary mb-2 mr-sm-2">
                                        수정
                                    </button>
                                    <button type="button" id="delete" class="btn btn-primary mb-2 mr-sm-2">
                                        탈퇴
                                    </button>
                                </td>
                            </tr>
                            </table>
                        </div>
                    </div>
                </div>

            </div>
        </div>

    </section>

    <!-- main modal -->
    <div class="modal fade" id="myModal">
        <div class="modal-dialog modal-lg modal-dialog-centered">
            <div class="modal-content">

                <!-- Modal Header -->
                <div class="modal-header">
                    <h4 class="modal-title"><a></a></h4>
                    <button type="button" class="close" data-dismiss="modal">&times;</button>

                </div>

                <!-- Modal body -->
                <div class="modal-body">
                    <div class="ftco-animate fadeInUp ftco-animated">
                        <div style="height:300px; overflow-y: scroll;">
                            <div class="card bg-primary text-white" data-toggle="modal" data-target="#myDay">
                                <div class="card-body">
                                    <a><span class="tag" style="font-weight: bold; font-size: 30px">Day1</span></a>
                                </div>
                            </div>
                            <br>
                        </div>
                    </div>
                </div>

                <!-- Modal footer -->
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                </div>

            </div>
        </div>
    </div>


    <!-- sub modal -->
    <div class="modal fade" id="myDay">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">

                <!-- Modal Header -->
                <div class="modal-header">
                    <h4 class="modal-title">Modal Heading</h4>
                    <button type="button" class="close" data-dismiss="modal">&times;</button>
                </div>

                <!-- Modal body -->
                <div class="modal-body">
                    <div class="ftco-animate fadeInUp ftco-animated">
                        <div style="height:500px; overflow-y: scroll;">

                            <!-- 카드들 담기는 곳-->
                            <div class="placeList">
                                <th:block th:each="place : ${placeList}">
                                    <div class="col-12 ftco-animate fadeInUp ftco-animated">
                                        <div class="block-21 mb-4 d-flex placeBox" id="content_id" name="content_id" th:value="${place.contentId}">
                                            <a class="blog-img mr-4 placeImage" th:style="'background:url(' + ${place.thumbnailUrl} + ')'"></a>
                                            <div class="text">
                                                <h3 class="heading placeTitle" th:text="${place.name}"></h3>
                                                <p class="placeAddr" th:text="${place.addr1}"></p>
                                            </div>
                                        </div>
                                    </div>
                                </th:block>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Modal footer -->
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                </div>

            </div>
        </div>
    </div>

    <script>
        $( document ).ready(function() {

            // plan 카드 클릭했을 때
            $(".planCard").click(function (){
                let title = $(this).find(".heading").find("a").text();
                let id = $(this).find(".plan_id").val();

                let days = [];
                let planObj;


                $(".modal-title").find("a").text(title);

                $.ajax({
                    // url 만들면 무조건 security 해야됨
                    url: '/mypage/myplan',
                    type: 'get',
                    dataType: 'json',
                    data: {"id": id},
                    contentType: 'application/json; charset=UTF-8',
                    success: function(res) {
                        console.log(res);

                        let dayCnt = res['dayCounts'];
                        let dayList = res['days'];

                        // day들 각각 작성
                        let dayCard = '<div class="card bg-primary text-white" data-toggle="modal" data-target="#myDay">\n' +
                            '                                <div class="card-body">\n' +
                            '                                    <a><span class="tag" style="font-weight: bold; font-size: 30px">Day1</span></a>\n' +
                            '                                </div>\n' +
                            '                            </div>'


                            $(".card").after(dayCard);


                        for(let i=0 ; i<dayCnt; ++i){
                            console.log('day' + (i+1) + '의 장소들');
                            let placeList = dayList[i]['places'];




                            for(let j =0; j<placeList.length; ++j){
                                // day i 번째의  j번째 place 각각 작업

                                console.log((j+1)+ '번째 장소');
                                console.log(placeList[j]);
                            }

                        }
                    }
                }).done(function(response) {
                    console.log('done!');
                });




            }); // click 했을 때 끝



            // day 하나씩 클릭했을 때
            $(".dayModal").click(function () {
                let title = $(this).find(".heading").find("h3").text();

                $(".") // places

            });


        });

    </script>

    </body>
</div>
</html>