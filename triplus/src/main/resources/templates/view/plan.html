<html lang="en"
      xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="layout/common_layout">

<div layout:fragment="content">
    <section class="ftco-section bg-light">
        <div class="container">
            <div class="col-md-7 heading-section ftco-animate fadeInUp ftco-animated">
                <h2 class="mb-4"><strong>나의 일정</strong> 만들기 </h2>
            </div>

            <div class="form-group">
                <div class="row">
                    <input type="text" class="form-control col-4 mb-2 mr-sm-2" placeholder="일정 이름">
                    <button type="button" id="save-all-btn" class="btn btn-primary mb-2 mr-sm-2">
                        SAVE
                    </button>
                </div>
            </div>

            <div class="form-group">
                <div class="row">
                    <div class="col-4 day">
                        <h2 class="text-center">Day</h2>
                        <div class="card" style="height: 500px">
                            <div style="height:450px; overflow-y: scroll;" class="mt-4">
                                <div class="card-body">
                                    <div class="row">
                                        <button type="button" id="delete_btn" class="btn btn-default mb-2 mr-sm-2 delete_btn">
                                            delete
                                        </button>
                                        <button type="button" id="save" class="btn btn-primary mb-2 mr-sm-2">
                                            SAVE
                                        </button>
                                    </div>

                                    <!-- 돌하르방 div-->
                                    <div class="block-21 mb-4 mt-4 d-flex place">
                                        <a class="blog-img mr-4" style="background:url(http://tong.visitkorea.or.kr/cms/resource/13/656813_image2_1.jpg); background-size: cover; background-repeat: no-repeat;"></a>
                                        <div class="text">
                                            <h3 class="heading"><a href="/detail?content_id=128777">북촌 돌하르방공원</a></h3>
                                            <p>제주특별자치도 제주시 조천읍 북촌서1길 70</p>
                                        </div>
                                    </div>

                                    <div class="col text-center">
                                        <button type="button" class="btn btn-default mb-2 mr-sm-2 add_btn" data-toggle="modal" data-target="#myModal">
                                            +
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>


            <div class="col text-center">

                <button type="button" id="card_add" class="btn btn-primary card_add">
                    ADD
                </button>
            </div>

        </div>
    </section>

    <!- modal -->
    <div class="modal fade" id="myModal">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">

                <!-- Modal Header -->
                <div class="modal-header">
                    <h4 class="modal-title">Modal Heading</h4>
                    <button type="button" class="close" data-dismiss="modal">&times;</button>
                </div>

                <!-- Modal body -->
                <div class="modal-body">
                    <div class="ftco-animate fadeInUp ftco-animated">
                        <h3>인근 명소</h3>
                        <div style="height:500px; overflow-y: scroll;">

                            <!-- 카드들 담기는 곳-->
<!--                            <th:block th:each="place : ${placeList}">-->
                            <div class="col-12 ftco-animate fadeInUp ftco-animated">
                                <div class="block-21 mb-4 d-flex place-box">
                                    <a class="blog-img mr-4 place-image" style="background:url(http://tong.visitkorea.or.kr/cms/resource/13/656813_image2_1.jpg); background-size: cover; background-repeat: no-repeat;"></a>
                                    <div class="text">
                                        <h3 class="heading place-title">북촌 돌하르방공원 1</h3>
                                        <p class="place-addr">제주특별자치도 제주시 조천읍 북촌서1길 70 1</p>
                                    </div>
                                </div>
                            </div>
<!--                            </th:block>-->
                            <div class="col-12 ftco-animate fadeInUp ftco-animated">
                                <div class="block-21 mb-4 d-flex place-box">
                                    <a class="blog-img mr-4 place-image" style="background:url(http://tong.visitkorea.or.kr/cms/resource/13/656813_image2_1.jpg); background-size: cover; background-repeat: no-repeat;"></a>
                                    <div class="text">
                                        <h3 class="heading place-title">북촌 돌하르방공원 2</h3>
                                        <p class="place-addr">제주특별자치도 제주시 조천읍 북촌서1길 70 2</p>
                                    </div>
                                </div>
                            </div>

                            <div class="col-12 ftco-animate fadeInUp ftco-animated">
                                <div class="block-21 mb-4 d-flex place-box">
                                    <a class="blog-img mr-4 place-image" style="background:url(http://tong.visitkorea.or.kr/cms/resource/13/656813_image2_1.jpg); background-size: cover; background-repeat: no-repeat;"></a>
                                    <div class="text">
                                        <h3 class="heading place-title">북촌 돌하르방공원 3</h3>
                                        <p class="place-addr">제주특별자치도 제주시 조천읍 북촌서1길 70 3</p>
                                    </div>
                                </div>
                            </div>

                        </div>
                    </div>
                </div>

                <!-- Modal footer -->
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                </div>

            </div>
        </div>
    </div>


    <script type="text/javascript">
        $(document).ready(function(){   // ready 시작
            make_place = function(url, title, addr, content_id){
                return '<div class="block-21 mb-4 mt-4 d-flex place">' +
                '    <a class="blog-img mr-4" style="background:url(' + url + '); background-size: cover; background-repeat: no-repeat;"></a>' +
                '    <div class="text">' +
                '    <h3 class="heading"><a href="/detail?content_id=' + content_id + '">' + title + '</a></h3>' +
                '        <p>' + addr + '</p>' +
                '    </div>' +
                '</div>';
            }

            var card = `<div class="col-4 day">
                    <h2 class="text-center">Day</h2>
                    <div class="card" style="height: 500px">
                        <div style="height:450px; overflow-y: scroll;" class="mt-4">
                            <div class="card-body">
                                <div class="row">
                                    <button type="button" id="delete_btn" class="btn btn-default mb-2 mr-sm-2 delete_btn">
                                        delete
                                    </button>
                                    <button type="button" id="save" class="btn btn-primary mb-2 mr-sm-2">
                                        SAVE
                                    </button>
                                </div>

                                <div class="block-21 mb-4 mt-4 d-flex place">
                                    <a class="blog-img mr-4" style="background:url(http://tong.visitkorea.or.kr/cms/resource/13/656813_image2_1.jpg); background-size: cover; background-repeat: no-repeat;"></a>
                                    <div class="text">
                                        <h3 class="heading"><a href="/detail?content_id=128777">북촌 돌하르방공원</a></h3>
                                        <p>제주특별자치도 제주시 조천읍 북촌서1길 70</p>
                                    </div>
                                </div>

                                <div class="col text-center">
                                    <button type="button" class="btn btn-default mb-2 mr-sm-2 add_btn" data-toggle="modal" data-target="#myModal">
                                        +
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                `

            add_btn_click = function(){
                var add_place_btn = $(this);
                var last_place = add_place_btn.parent().parent().find(".place:last");

                last_place.addClass('last-place');
            }


            $(".add_btn").unbind().click(add_btn_click);


            // 검색해서 클릭했을 때
            $(".place-box").click(function(){
                var imgUrl = $(this).find("a").css('background');
                var title = $(this).find(".text").find("h3").text();
                var addr = $(this).find(".text").find("p").text();
                var content_id = $(this).find('#content_id').text();
                var last_place = $(".last-place");
                imgUrl = imgUrl.replace(/.*\s?url\([\'\"]?/, '').replace(/[\'\"]?\).*/, '');

                // console.log(imgUrl);
                // console.log(title);
                // console.log(addr);

                $('#myModal').modal('hide');

                // TODO content_id 작업 해줘야함
                last_place.after(make_place(imgUrl, title, addr, content_id));
                last_place.removeClass('last-place');
            });

            // 새로울 Day를 만들 때
            $(".card_add").click(function(){
                $(".last-place").removeClass('last-place');

                $(".day:last").after(card);

                $(".add_btn").unbind().click(add_btn_click);

            }); // card_add btn click 끝


            // 저장할 때
            $('#save-all-btn').click(function(){
                day = [];

                place = {
                    'title': '1',
                    'imgUrl': '2',
                    'addr': '3',
                    'contentId': '4'
                };

                dayList = $('.day').toArray();
                dayList = dayList.map(function(day){
                    var title = $(day).find('.place').find('.text').find('.heading').text();
                    var addr = $(day).find('.place').find('.text').find('p').text();
                    var imgUrl = $(day).find('.place').find('a').css('background').replace(/.*\s?url\([\'\"]?/, '').replace(/[\'\"]?\).*/, '');
                    var contentId = 3223;

                    console.log(title);
                    var jsonStr = '{ "title": "' + title + '", "imgUrl": "' + imgUrl +'", "addr":"' + addr + '", "conent_id":"' + contentId + '"}';
                    console.log(jsonStr);
                    return (JSON.parse(jsonStr));
                });

                console.log(dayList);
            });

        }); // ready 끝

    </script>

</div>
</html>