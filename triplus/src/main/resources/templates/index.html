<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
	  xmlns:th="http://www.thymeleaf.org"
	  xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
	  layout:decorate="layout/common_layout">

<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

<div layout:fragment="content">
	<div id="carouselExampleIndicators" class="carousel slide" data-ride="carousel">
		<ol class="carousel-indicators">
			<li data-target="#carouselExampleIndicators" data-slide-to="0" class=""></li>
			<li data-target="#carouselExampleIndicators" data-slide-to="1" class=""></li>
			<li data-target="#carouselExampleIndicators" data-slide-to="2" class="active"></li>
		</ol>
		<div class="carousel-inner" role="listbox">
			<div class="carousel-item">
				<img class="d-block img-fluid" th:src="@{/images/bg_5.jpg}" style="width:100%; height:700px; opacity: 0.8" alt="First slide">
			</div>
			<div class="carousel-item">
				<img class="d-block img-fluid" th:src="@{/images/bg_2.jpg}" style="width:100%; height:700px; opacity: 0.8" alt="Second slide">
			</div>
			<div class="carousel-item active">
				<img class="d-block img-fluid" th:src="@{/images/bg_3.jpg}" style="width:100%; height:700px; opacity: 0.8" alt="Third slide">
			</div>

			<div class="overlay">
				<div class="container">
					<div class="row no-gutters slider-text align-items-center justify-content-start" data-scrollax-parent="true" style="height: 700px;">

						<div class="col-12 align-items-center">

							<div class="row d-flex justify-content-center">
								<div class="col-6 text-center heading-section heading-section-white ftco-animate fadeInUp ftco-animated">
									<h2  th:if="${checked}" th:text="${nickname} + '님 안녕하세요'"></h2>
									<h2 style="font-weight: bold;">어디로 떠나나요?</h2>

									<div class="block-17 my-4">
										<form th:action="@{/search}" th:method="get" class="d-block d-flex">
											<div class="fields d-block d-flex">
												<input type="text" class="form-control" name="keyword" placeholder="키워드를 검색해주세요">
											</div>
												<input type="submit" class="search-submit btn btn-primary" value="Search">
										</form>
									</div>
								</div>
							</div>
						</div>
					</div>
				</div>
			</div>

		</div>
		<a class="carousel-control-prev" href="#carouselExampleIndicators" role="button" data-slide="prev">
			<span class="carousel-control-prev-icon" aria-hidden="true"></span>
			<span class="sr-only">Previous</span>
		</a>
		<a class="carousel-control-next" href="#carouselExampleIndicators" role="button" data-slide="next">
			<span class="carousel-control-next-icon" aria-hidden="true"></span>
			<span class="sr-only">Next</span>
		</a>
	</div>

<!--	<section class="ftco-section bg-light">-->
<!--		<div class="container">-->
<!--			<div class="text-center">-->
<!--				<h1 class="section-heading text-uppercase">Services</h1>-->
<!--				<h6 class="section-subheading text-muted">Triplus는 Trip과 plus 라는 단어를 합쳐 '여행을 더하다' 라는 의미와 [트리플어스] = Trip + Us 의 우리, 같이의 여행을 담고 있습니다.</h6>-->
<!--			</div>-->
<!--			<div class="row text-center">-->
<!--				<div class="col-md-4">-->
<!--					<i class="far fa-calendar-alt fa-lg mb-2 mr-sm-2"></i>-->
<!--					<h4 class="my-3">E-Commerce</h4>-->
<!--					<p class="text-muted">내 일정 직접 만들 수 </p>-->
<!--				</div>-->
<!--				<div class="col-md-4">-->
<!--					<i class="far fa-comment fa-lg mb-2 mr-sm-2"></i>-->
<!--					<h4 class="my-3">Responsive Design</h4>-->
<!--					<p class="text-muted">키워드 검색으로 찾아보는 여행지 !</p>-->
<!--				</div>-->
<!--				<div class="col-md-4">-->
<!--					<i class="fas fa-heart fa-lg mb-2 mr-sm-2"></i>-->
<!--					<h4 class="my-3">Web Security</h4>-->
<!--					<p class="text-muted">전국 모든 여행지를 한눈에 !</p>-->
<!--				</div>-->
<!--			</div>-->
<!--		</div>-->
<!--	</section>-->


	<section class="ftco-section">
		<div class="container">
			<div class="row justify-content-start">
				<div class="col-md-6 heading-section ftco-animate fadeInUp ftco-animated">
					<h2 class="mb-4 pb-3"><strong>Why</strong> TRIPlus?</h2>
					<p>Triplus는 Trip과 plus 라는 단어를 합쳐 '여행을 더하다' 라는 의미와 [트리플어스] = Trip + Us 의 '우리, 같이의 여행' 이라는 의미를 담고 있습니다.</p>
					<p>직접 일정을 만들 수도 있고 전국 모든 여행지를 볼 수 있습니다.</p>
					<p><a href="#" class="btn btn-primary btn-outline-primary mt-4 px-4 py-3">Read more</a></p>
				</div>
				<div class="col-md-1"></div>
				<div class="col-md-5">
					<div class="col-md-12">
						<div class="row">
							<div class="col-md-3">
								<button class="btn btn-primary mt-4 mr-sm-2">
									<i class="far fa-calendar-alt fa-3x " aria-hidden="true"></i>
								</button>
							</div>
							<div class="col-md-9">
								<h4 class="my-3">일정 만들기</h4>
								<p class="text-muted">직접 만드는 내 일정 !</p>
							</div>
						</div>
					</div>
					<div class="col-md-12">
						<div class="row">
							<div class="col-md-3">
								<button class="btn btn-primary mt-4 mr-sm-2">
									<i class="far fa-comment fa-3x " aria-hidden="true"></i>
								</button>
							</div>
							<div class="col-md-9">
								<h4 class="my-3">전국 여행지 및 모든 일정</h4>
								<p class="text-muted">전국 모든 여행지와 일정을 한 눈에 !</p>
							</div>
						</div>
					</div>
					<div class="col-md-12">
						<div class="row">
							<div class="col-md-3">
								<button class="btn btn-primary mt-4 mr-sm-2">
									<i class="fas fa-heart fa-3x " aria-hidden="true"></i>
								</button>
							</div>
							<div class="col-md-9">
								<h4 class="my-3">키워드 검색</h4>
								<p class="text-muted">키워드 검색으로 찾아보는 여행지 !</p>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
	</section>

	<!-- place 테이블에서 받은 데이터 뿌려지는 곳 -->
	<section class="ftco-section ftco-destination">
		<div class="container">
			<div class="row justify-content-start">
				<div class="col-md-7 heading-section ftco-animate">
					<h2 class="mb-4"><strong>인기명소</strong> Top6 </h2>
				</div>
			</div>
			<div class="row">
				<div class="col-md-12">
					<div class="destination-slider owl-carousel ftco-animate">
						<div class="item" th:each="place : ${placeList}">
							<div class="destination">
								<a th:href="@{/detail?content_id={id}(id=${place.contentId})}" class="block-20" th:style="'background:url(' + ${place.thumbnailUrl} + ');background-size:cover'">
								</a>
								<div class="text p-4 d-block">
									<h3 class="heading mb-2" style="font-weight: bold;"><a th:href="@{/detail?content_id={id}(id=${place.contentId})}" th:text="${place.name}"></a></h3>
									<div class="mb-4"><a th:text="${place.addr1}"></a></div>
									<div class="meta" style="text-align : right;">
										<span><i class="fas fa-heart" th:text="' ' + ${place.liked}"></i></span>
									</div>
								</div>
							</div>
						</div>

					</div>
				</div>
			</div>
		</div>
	</section>

	<!-- main modal -->
	<div class="modal fade" id="myModal">
		<div class="modal-dialog modal-md modal-dialog-centered">
			<div class="modal-content">

				<!-- Modal Header -->
				<div class="modal-header">
					<h3 class="plan-title"><a></a></h3>
					<button type="button" class="close" data-dismiss="modal">&times;</button>
				</div>

				<!-- Modal body -->
				<div class="modal-body">
					<div class="ftco-animate fadeInUp ftco-animated">
						<div id="modalScroll" style="height: auto; overflow-y: scroll;">
							<div class="card bg-primary text-white" data-toggle="modal" data-target="#myDay" style="display: none !important;">
								<div class="card-body">
									<a><span class="tag" style="font-weight: bold; font-size: 30px">Day</span></a>
								</div>
							</div>
						</div>
					</div>
				</div>

				<!-- Modal footer -->
				<div class="modal-footer">
					<button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
				</div>
			</div>
		</div>
	</div>


	<!-- sub modal -->
	<div class="modal fade" id="myDay">
		<div class="modal-dialog modal-dialog-centered">
			<div class="modal-content">

				<!-- Modal Header -->
				<div class="modal-header text-center">
					<h3 class="day-title" style="font-weight: bold;"><a></a></h3>
					<button type="button" class="close" data-dismiss="modal">&times;</button>
				</div>

				<!-- Modal body -->
				<div class="modal-body">
					<div class="ftco-animate fadeInUp ftco-animated">
						<div style="height: auto; overflow-y: scroll;">

							<!-- 카드들 담기는 곳-->
							<div class="placeList">
								<div class="col-12 ftco-animate fadeInUp ftco-animated" id="placeScroll">
									<div class="block-21 mb-4 d-flex placeBox" style="display: none !important;">
										<a class="blog-img mr-4 placeImage"></a>
										<div class="text">
											<h3 class="heading placeTitle"></h3>
											<p class="placeAddr" ></p>
										</div>
									</div>
								</div>
							</div>

						</div>
					</div>
				</div>

				<!-- Modal footer -->
				<div class="modal-footer">
					<button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
				</div>

			</div>
		</div>
	</div>

	<script>
		$( document ).ready(function() {


			let planObj;
			let dayCnt;
			let dayList;
			let placeList;

			const getDay = function (idx) {
				return '<div class="card bg-primary text-white" data-toggle="modal" data-target="#myDay">\n' +
						'                                <div class="card-body text-center">\n' +
						'                                    <a><span class="tag" style="font-weight: bold; font-size: 30px">Day ' + idx + '</span></a>\n' +
						'                                </div>\n' +
						'                            </div>';
			};


			// 각 plan 카드 클릭했을 때
			$(".planCard").click(function (){
				$("#modalScroll").find(".card").remove();
				$("#modalScroll").append('       <div class="card bg-primary text-white" data-toggle="modal" data-target="#myDay" style="display: none !important;">\n' +
						'                                <div class="card-body">\n' +
						'                                    <a><span class="tag" style="font-weight: bold; font-size: 30px">Day</span></a>\n' +
						'                                </div>\n' +
						'                            </div>\n');

				let title = $(this).find(".planTitle").find("a").text();
				let id = $(this).find(".plan_id").val();


				$(".plan-title").find("a").text(title);


				$.ajax({
					// url 만들면 무조건 security 해야됨
					url: '/mypage/myplan',
					type: 'get',
					async: false,
					dataType: 'json',
					data: {"id": id},
					contentType: 'application/json; charset=UTF-8',
					success: function(res) {
						console.log(res);
						planObj = res;

						dayCnt = res['dayCounts'];
						dayList = res['days'];


						for (let d = 0; d < dayCnt; ++d) {
							// day들 각각 작성
							$(".card:last").after(getDay(d + 1));
							console.log('day' + (d + 1) + '의 장소들');

							$(".card:last").unbind().click(function () {

								$(".day-title").text('Day' + (d+1));

								$("#placeScroll").find(".placeBox").remove();
								$("#placeScroll").append('                  <div class="block-21 mb-4 d-flex placeBox" style="display: none !important;">\n' +
										'                                            <a class="blog-img mr-4"><img class="placeImage"/></a>\n' +
										'                                            <div class="text">\n' +
										'                                                <h3 class="heading placeTitle"></h3>\n' +
										'                                                <p class="placeAddr" ></p>\n' +
										'                                            </div>\n' +
										'                                        </div>');


								placeList = dayList[d]['places'];

								for (let p = 0; p < placeList.length; ++p) {
									// day d 번째의  p번째 place 각각 작업
									console.log((p + 1) + '번째 장소');
									console.log(placeList[p]);
									console.log(placeList.length);


									let img = placeList[p]['thumbnailUrl'];
									let name = placeList[p]['name'];
									let addr = placeList[p]['addr'];


									$(".placeBox:last").after('                                    <div class="block-21 mb-4 d-flex placeBox">\n' +
											'                                        <a class="blog-img mr-4 placeImage" style="background:url(' + img + ')"></a>\n' +
											'                                        <div class="text">\n' +
											'                                            <h3 class="heading placeTitle">' + name + '</h3>\n' +
											'                                            <p class="placeAddr">' + addr + '</p>\n' +
											'                                        </div>\n' +
											'                                    </div>');

								}

							});

						}
					}

				}).done(function(response) {
					console.log('done!');
				});


			}); // planCard 클릭 했을 때 끝

		});


	</script>

	<div layout:fragment="configFragment">
		<script src="js/jquery.min.js"></script>
		<script src="js/jquery-migrate-3.0.1.min.js"></script>
		<script src="js/popper.min.js"></script>
		<script src="js/bootstrap.min.js"></script>
		<script src="js/jquery.easing.1.3.js"></script>
		<script src="js/jquery.waypoints.min.js"></script>
		<script src="js/jquery.stellar.min.js"></script>
		<script src="js/owl.carousel.min.js"></script>
		<script src="js/jquery.magnific-popup.min.js"></script>
		<script src="js/aos.js"></script>
		<script src="js/jquery.animateNumber.min.js"></script>
		<script src="js/bootstrap-datepicker.js"></script>
		<script src="js/jquery.timepicker.min.js"></script>
		<script src="js/scrollax.min.js"></script>
		<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBVWaKrjvy3MaE7SQ74_uJiULgl1JY0H2s&sensor=false"></script>
		<script src="js/google-map.js"></script>
		<script src="js/main.js"></script>

	</div>

	<script th:if="${status == 'login'}">
		$("#loginModal").modal();
	</script>


</div>
</html>